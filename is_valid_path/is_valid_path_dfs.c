#include <assert.h>
#include <stdbool.h>
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <sys/_types/_sigaltstack.h>
#include <unistd.h>

#include "../stack.c"

#define BUFFER_SIZE 10024

bool is_valid(int row, int col, char map[101][1024]) {
    if (row < 0 || col < 0 || row >= 101 || map[row][col] == '\0' ||
        map[row][col] == ' ')
        puts("invalid"), exit(1);
    if (map[row][col] == '1' || map[row][col] == 'S')
        return false;
    return true;
}

int main() {
    char map[101][1024] = {
        "1111111111111111",
        "1P0000100000001",
        "100001111111111111111 111",
        "10000011000000000000010001",
        "10000010000000000000000001",
        "10000011000000000000010001",
        "1110111111111111111110001",
        "110000110000001      10001",
        "100000010000001     10001",
        "100000010000001      10001",
        "10000000000000111111111111111111111",
        "10000001000000100000000000000000001",
        "100000010000000000000000000000000011111",
        "110000110000001001110000000000110010001",
        "111111111111111001000000000000010010001",
        "              1000000000000000000010001",
        "              1000000000000000000010001",
        "              100000000000000000000001",
        "              1000000000000000000010001",
        "              1000000000000000000010001",
        "              1001000000000000010010001",
        "              1001100000000000110010001",
        "              1000000000000000000010001",
        "              1000000000000000000010001",
        "              1111111111111111111110001",
        "                                   10001",
        "                               11110001111",
        "                               10000000001",
        "   1111111111111               10000000001",
        "   1000000000001               10000000001",
        "   1000000000001               10000000001",
        "   1000000000001               10000000001",
        "   1000000000001               10100000101",
        "   1000000000001               10000000001",
        "   10011111111111111111111     11111011111",
        "   10000000000000000000001       100001",
        "   11110000000000000000001       100001",
        "      10000000000000000001       100001",
        "  111110000000000001111111111111100001",
        "  1000000000000000010000000000000000001",
        "  1000010000000000000000000000000000001",
        "  1000100000000000010000000000000000001",
        "  1000111111011111110000000000000000001",
        "  1000000010001    1111111111111111111",
        "  1000000000001    100000000001",
        "  1000000010001    100000000001",
        "  1111011110001    100000000001",
        "    10001 10101    100000000001",
        "    10001110111    100000000001",
        "    10000000001    100000000001",
        "    11111100001    111111011111",
        "         110001        10001",
        "          10001        10001",
        "           10001       10101",
        "            10001      11111",
        "             10001",
        "              10001",
        "               10001",
        "                10001111111111111111111111111111111111111",
        "                10000010001000001000000010000000001010001",
        "                11101010101011101011101110111011101011101",
        "                10001000101010101000100000101010000000001",
        "                10101110111110101111111010101110111111111",
        "                10101010100000000010000010100010100010001",
        "                10111011111111111010111110101111111010101",
        "                10101010001000001010000010000010100000101",
        "                10101010101110111011101011111110111111101",
        "                10000010101000001000001010100010001000001",
        "                10101010111111101110111110101111101011101",
        "                10101000000010000010000000000010000000101",
        "                11101010111110111010101011101110111111111",
        "                10101010000000100000101000100000100000001",
        "                10101110111010111010101111111110101111101",
        "                10001000001010001010101000000010000010101",
        "                10111011101110101011111011101110111010101",
        "                10100010001010101000001000100010001010101",
        "                10111010101011101111101011101111101010101",
        "                10100010101000101000100000100010101010001",
        "                10111010101110101110101011111110111011101",
        "                10101010100000101000001000100010001010101",
        "                10101110101111111110101111101110101010101",
        "                10001000100010000000100010000010101010101",
        "                10101011101010101111111110111110111010111",
        "                10101010001010100000000000100000100010001",
        "                10101011111011111111111110101111111111101",
        "                1E101000101000001000001000101000001000001",
        "                11101110101111111010111110101010111011111",
        "                10001000000010000010100010000010100000001",
        "                10111111111011101010101111111110111111101",
        "                10100000001000001010000010000010001010001",
        "                11101010111110111011111010111111101010101",
        "                10001010100000100000001010100000100010101",
        "                11111111111111111111111111111111111111111"};

    stack s = init_stack();

    push_to_stack(&s, (int[2]){1, 1});
    int valid = 0;
    while (s.size) {
        int* cur = pop_from_stack(&s);
        int j = cur[0];
        int i = cur[1];
        if (map[j][i] == 'E') {
            valid = 1;
            break;
        }
        if (map[j][i] == '1' || map[j][i] == 'S')
            continue;
        map[j][i] = 'S';
        if (is_valid(j, i - 1, map))
            push_to_stack(&s, (int[2]){j, i - 1});
        if (is_valid(j - 1, i, map))
            push_to_stack(&s, (int[2]){j - 1, i});
        if (is_valid(j, i + 1, map))
            push_to_stack(&s, (int[2]){j, i + 1});
        if (is_valid(j + 1, i, map))
            push_to_stack(&s, (int[2]){j + 1, i});
    }

    if (valid)
        puts("valid");
    else
        return puts("invalid");

    for (int i = 0; i < 101; ++i) {
        int j = 0;
        while (map[i][j]) {
            if (map[i][j] == '1')
                printf("%c", '|');
            else if (map[i][j] == 'S')
                printf("%c", 'x');
            else if (map[i][j] == '0')
                printf("%c", '.');
            else if (map[i][j] == 'E')
                printf("%c", 'E');
            else
                printf("%c", ' ');
            ++j;
        };
        printf("\n");
    }
}
